# 4. Memory: Recall

<pre>
â”œâ”€â”€ <a href="../README.md">..</a>
â”œâ”€â”€ <a href="./1.memory.md">1. Memory</a>
â”œâ”€â”€ <a href="./2.ingestion.md">2. Ingestion</a>
â”œâ”€â”€ <a href="./3.guards.md">3. Guards</a>
â”œâ”€â”€ <span><a href="./4.recall.md"><b>4. Recall</b></a> ðŸ‘ˆ</span>
|   â”œâ”€â”€ <a href="#41-trigger">4.1 Trigger</a>
|   â”œâ”€â”€ <a href="#42-reinforce">4.2 Reinforce</a>
|   â”œâ”€â”€ <a href="#43-reclassify">4.3 Reclassify</a>
|   â””â”€â”€ <a href="#44-store">4.4 Store</a>
â”œâ”€â”€ <a href="./5.classification.md">5. Classification</a>
â””â”€â”€ <a href="./README.md">â–¾ 6. Research/</a>
    â”œâ”€â”€ <a href="./merc/README.md">â–¸ 6.1 Merc/</a>
    â”œâ”€â”€ <a href="./reference/README.md">â–¸ 6.2 Reference/</a>
    â””â”€â”€ <a href="./analysis/README.md">â–¸ 6.3 Analysis/</a>
</pre>

A **recall** is the act of retrieving a stored memory back into the "active workspace" when something in the present (a cue, a question, a situation) matches it enough to be useful.

> **Note:** Merc is stateless and handles only the ingestion/scoring phase. Recall is handled by downstream systems (Zep, Hindsight, etc.). This document describes the conceptual recall pipeline.

---

## Recall Flow

```mermaid
flowchart LR
    A[Trigger] --> B[Search]
    B --> C[Retrieve]
    C --> D[Use]
    D --> E[Reinforce]
    E --> F[Reclassify?]
    F --> G[Store]
```

---

## 4.1 Trigger

A recall is triggered when the current context matches stored memories. Triggers can be:

### Explicit Triggers

| Type | Example | Source |
|------|---------|--------|
| Direct query | "What did I say about the project?" | User request |
| Keyword match | Conversation mentions "deadline" | Semantic search |
| Entity reference | "Remind me about John's email" | Named entity |

### Implicit Triggers

| Type | Example | Source |
|------|---------|--------|
| Temporal | Task deadline approaching | Time-based |
| Contextual | Similar conversation pattern | Embedding similarity |
| Emotional | High-stress situation recalls past stress | Emotional state |

### Search Strategies

Different memory systems use different search strategies:

| System | Strategy | Description |
|--------|----------|-------------|
| **Vector search** | Embedding similarity | Find semantically similar memories |
| **Keyword search** | Lexical match | Exact term matching |
| **Graph traversal** | Entity relationships | Follow connections in knowledge graph |
| **Temporal search** | Time-based | Memories from specific time periods |

See [reference docs](./reference/) for how specific systems (Zep, Hindsight) implement search.

---

## 4.2 Reinforce

When a memory is recalled and used successfully, it should be **reinforced**â€”increasing its strength and durability.

### Reinforcement Signals

| Signal | Effect | Rationale |
|--------|--------|-----------|
| **Recall frequency** | Increase strength | Frequently recalled = important |
| **Successful use** | Increase confidence | Memory was helpful |
| **Positive feedback** | Boost priority | User confirmed value |
| **Time decay** | Decrease strength | Unused memories fade |

### Strength Update

```
new_strength = old_strength + Î± * (1 - old_strength)
```

Where:
- `Î±` = learning rate (typically 0.1-0.3)
- Higher strength memories receive smaller boosts (diminishing returns)

### Decay Function

```
decayed_strength = strength * e^(-Î» * days_since_recall)
```

Where:
- `Î»` = decay rate (system-dependent)
- Memories not recalled gradually fade

---

## 4.3 Reclassify

Over time, memories may need **reclassification** based on new information or usage patterns.

### Reclassification Triggers

| Trigger | Example | Action |
|---------|---------|--------|
| **Repeated recall** | Task recalled 10+ times | Episodic â†’ Semantic |
| **Contradiction** | New info conflicts with stored | Update or flag |
| **Context change** | Preference has changed | Mark as outdated |
| **Aggregation** | Multiple related memories | Merge into summary |

### Type Transitions

```mermaid
flowchart TD
    A[Episodic] -->|Repeated recall| B[Semantic]
    A -->|Emotional response| C[Emotional]
    D[Working] -->|Reinforced| A
    D -->|Not reinforced| E[Forget]
    B -->|Proven useful| F[Procedural]

    style E fill:#ef4444,color:#fff
```

Based on memory theory from [1.memory.md](./1.memory.md#13-types):
- **Episodic â†’ Semantic:** Specific events become general knowledge through repetition
- **Working â†’ Episodic:** Short-term memories consolidated through reinforcement
- **Working â†’ Forget:** Unreinforced working memories decay

### Contradiction Handling

When new information contradicts stored memories:

| Strategy | System | Description |
|----------|--------|-------------|
| **Bi-temporal** | Zep | Keep both with timestamps |
| **Confidence update** | Hindsight | Lower confidence of old memory |
| **Replace** | Simple | Overwrite with new |

See [Merc vs Zep](./analysis/2.merc-vs-zep.md) for contradiction handling comparison.

---

## 4.4 Store

After recall, reinforcement, and potential reclassification, the memory is stored back.

### Update Operations

| Operation | When | Effect |
|-----------|------|--------|
| **Strength update** | Every recall | Increase/decrease strength |
| **Type change** | Reclassification | Move to different store |
| **Metadata update** | New context | Add recall context |
| **Merge** | Aggregation | Combine related memories |

### Storage Considerations

- **Atomic updates** â€” Ensure consistency during updates
- **Version history** â€” Track changes for bi-temporal queries
- **Index updates** â€” Keep search indices current
- **Cascade effects** â€” Update related memories (knowledge graph)

---

## Integration with Merc

While Merc doesn't handle recall directly, it provides signals useful for downstream recall systems:

| Merc Signal | Recall Use |
|-------------|------------|
| `labels` | Index by topic for search |
| `score` | Initial strength value |
| `category_scores` | Type classification hints |
| Temporal labels | Time-based search support |

### Feedback Loop

Downstream recall systems can feed back to Merc:

```mermaid
flowchart LR
    A[Merc: Ingest] --> B[Store]
    B --> C[Recall System]
    C --> D[Use + Reinforce]
    D --> E[Feedback]
    E -.->|Weight tuning| A
```

See [Phase 4: Learning](./merc/roadmap/4.learning.md) for how feedback improves Merc's scoring.
